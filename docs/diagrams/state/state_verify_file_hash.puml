@startuml state_verify_file_hash

[*] --> EndpointCalled : Calls verify_file_hash endpoint
EndpointCalled --> SaveFiles : Save uploaded files[success]
EndpointCalled --> FileSaveError : Save uploaded files[failure]

SaveFiles --> LoadLinkFile : Load in-toto link file
LoadLinkFile --> ComputeHash : Compute hash of uploaded file
ComputeHash --> CompareHashes : Compare computed hash with recorded hash

CompareHashes --> HashMatch : Hash matches
CompareHashes --> HashMismatch : Hash mismatch
CompareHashes --> FileNotFound : File not found in link file

note left of LoadLinkFile
The .link file is not verified in this endpoint.
It is assumed to have been verified beforehand
using the /verify_in-toto_link endpoint.
This endpoint only checks the hash of the uploaded file
against the already verified .link file.
end note

FileSaveError --> [*]
HashMatch --> [*]
HashMismatch --> [*]
FileNotFound --> [*]

@enduml